<!DOCTYPE html>
<html>

<head>
  <title>Chatbot</title>
</head>
<style>
  body{
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
  }
  .button-style {
    background-color: green;
    color: white;
    border:none;
    padding:10px 20px;
    margin-left: 10px;
    border-radius: 10px;
  }
  .input-style{
    padding: 10px 15px;
    border: 1px solid grey;
    border-radius: 10px;
    font-size: 16px;
    background-color: #f5f5f5;
    flex-grow: 1;
  }
  .chat-input-style{
    display:flex;
    width:100%;
    margin-bottom: 50px;
  }
  .app-style{
    max-width:600px;
    margin:auto;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .chat-user-style{
    margin: 10px;
    display: flex;
    justify-content: flex-end;
  } 
  .chat-robot-style{
    margin: 10px;
    display: flex;
    justify-content: flex-start;
  }
  
  .chat-message-style{
    background-color: rgb(241, 235, 235);
    display: inline-block;
    padding: 10px 13px;
    border-radius: 10px;
    margin-left: 10px;
    margin-right: 10px;
    max-width: 300px;
  }
  .chat-messages-style{
    flex-grow: 1;
    margin-top: 20px;
    overflow: scroll;
    scrollbar-width: none;
    margin-bottom: 15px;
  }
  .img-style{
    border-radius: 50%;
    width: 45px;
    height: 45px;
  }
</style>

<body>
  <div class="js-container"></div>

  <script src="https://unpkg.com/supersimpledev/react.js"></script>
  <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

  <script src="https://unpkg.com/supersimpledev/babel.js"></script>
  <script type="text/babel">
    function ChatInput({ messages, setMessages }) {
      const [inputText, setInputText] = React.useState("");
      const [isLoading, setIsLoading] = React.useState(false);

      function saveInputText(event) {
        setInputText(event.target.value);
      }

      async function SendMessage() {
        if (isLoading) return;

        setIsLoading(true);

        const newMessages = [
          ...messages,
          {
            message: inputText,
            sender: "user",
            id: crypto.randomUUID()
          },
          {
            message: "Loading....",
            sender: "robot",
            id: crypto.randomUUID()
          }
        ];
        const updatedMessages = [...newMessages];

        setMessages(newMessages);
        setInputText("");
        const response = await Chatbot.getResponseAsync(inputText);
        
        updatedMessages[updatedMessages.length - 1] = {
          message: response,
          sender: "robot",
          id: crypto.randomUUID()
        };

        setMessages(updatedMessages);

        setIsLoading(false);

      }

      function keymessage(event) {
        if (event.key === "Enter") {
          SendMessage();
        }
        if (event.key === "Escape") {
          setInputText("");
        }
      }

      return (
        <div className="chat-input-style">
          <input
            placeholder="Send a message to Chatbot"
            size="30"
            onChange={saveInputText}
            value={inputText}
            onKeyDown={keymessage}
            className="input-style"
          />
          <button  onClick={SendMessage} disabled={inputText === ""} className="button-style" >Send</button>
        </div>
      );
    }

    function ChatMessage({ message, sender }) {
      // const message = props.message;
      // const sender = props.sender;
      // const { message, sender } = props;

      /*
      if (sender === 'robot') {
        return (
          <div>
            <img src="robot.png" width="50" />
            {message}
          </div>
        );
      }
      */

      return (
        <div className={sender === 'user' ? 'chat-user-style' : 'chat-robot-style'}>
          {sender === 'robot' && (
            <img src="robot.png" width="50" className="img-style"/>
          )}
          <div className="chat-message-style">
            {message}
          </div>
          {sender === 'user' && (
            <img src="user.png" width="50" className="img-style"/>
          )}
        </div>
      );
    }

    function ChatMessages({ messages }) {
      const chatMessagesRef = React.useRef(null);

      React.useEffect(() => {
        const containerElem = chatMessagesRef.current;
        if(containerElem){
          containerElem.scrollTop = containerElem.scrollHeight;
        }
      }, [messages]);
      
      return (
        <div className="chat-messages-style" ref={chatMessagesRef}>
          {messages.map((hola) => (
            <ChatMessage
              message={hola.message}
              sender={hola.sender}
              key={hola.id}
            />
          ))}
        </div>
      );


    }

    function App() {
      const array = React.useState([{
        message: "hello chatbot",
        sender: "user",
        id: "1"
      }, {
        message: "Hello! How can I help you?",
        sender: "robot",
        id: "2"
      }, {
        message: "can you get me todays date?",
        sender: "user",
        id: "3"
      }, {
        message: "Today is September 27",
        sender: "robot",
        id: "4"
      }]);

      const [messages, setMessages] = array;



      return (
        <div className="app-style">
          <ChatMessages
          messages={messages}
          />
          <ChatInput
            messages={messages}
            setMessages={setMessages}
          />
          </div>
      );
    }

    const container = document.querySelector('.js-container');
    ReactDOM.createRoot(container).render(<App />);
  </script>
</body>

</html>